<script>
/* eslint-disable */
import {notifyError} from "@/composables/messages";
import http from "@/http";
import env from "@/env";
import {useAuthStore} from "@/stores/auth.js";
import {endLoading} from "@/composables/spinners";


export default {
    page: {
        title: "Login",
        meta: [{
            name: "description",
        }],
    },
    data() {
        return {
            email: '',
            password: "",
            forgot_password: false,
            load: false,
            env,
            authStore: null,
        };
    },
    created() {
        this.authStore = useAuthStore();
    },
    methods: {
        login() {
            this.load = true;
            const self = this;
            const api = env.api + "login";

            http
                .post(api, {
                    email: self.email,
                    password: self.password,
                })
                .then((response) => {
                    // Cookies are set automatically by the backend
                    // No need to save token in localStorage
                    this.authStore.initialize();
                })
                .catch((error) => {
                    notifyError("Credenciais Inválidas");
                })
                .finally(() => {
                    setTimeout(() => {
                        this.load = false;
                    }, 300)
                })
        },
        showPass() {
            const type = document.getElementById('password-input').type;

            if (type === 'password') {
                document.getElementById('password-input').type = 'text';
            } else {
                document.getElementById('password-input').type = 'password';
            }

        }
    },

    mounted() {
        endLoading();
        if (window.location.href.indexOf('sistema.simplificagabinete') > -1) {
            this.email = '';
            this.password = '';
        } else if (window.location.href.indexOf('citygov') > -1) {
            this.email = 'contato@citygov.com.br';
        }
    }
};
</script>


<!--eslint-disable no-mixed-spaces-and-tabs-->
<template>
    <div class="auth-page-wrapper pt-5">
        <div
            class="auth-one-bg-position auth-one-bg bg-soft-primary"
            id="auth-particles"
        >

        </div>

        <div class="auth-page-content">
            <b-container>

                <b-row class="justify-content-center">
                    <b-col
                        md="8"
                        lg="6"
                        xl="5"
                    >
                        <b-card no-body>
                            <b-card-body class="p-4">
                                <div class="text-center">
                                    <img
                                        src="@/assets/logos/icon.png"
                                        alt="logo_bauminas"
                                        height="80"
                                    >
                                    <h5 class="mt-3">Seja bem Vindo!</h5>
                                    <p class="text-muted">Faça login para continuar.</p>
                                </div>
                                <div class="p-2 mt-4">

                                    <form @submit.prevent="login">
                                        <div class="mb-3">
                                            <label
                                                for="email"
                                                class="form-label"
                                            >Email
                                            </label>
                                            <input
                                                type="email"
                                                class="form-control"
                                                id="email"
                                                placeholder="Email de acesso"
                                                v-model="email"
                                            />
                                            <div class="invalid-feedback">
                                                <span></span>
                                            </div>
                                        </div>

                                        <div>
                                            <label
                                                class="form-label"
                                                for="password-input"
                                            >Senha
                                            </label>
                                            <div class="position-relative auth-pass-inputgroup mb-3">
                                                <input
                                                    type="password"
                                                    v-model="password"
                                                    class="form-control pe-5"
                                                    placeholder="Digite a Senha"
                                                    id="password-input"
                                                />
                                                <b-button
                                                    variant="link"
                                                    @click="showPass"
                                                    class="position-absolute end-0 top-0 text-decoration-none text-muted"
                                                    type="button"
                                                    id="password-addon"
                                                >
                                                    <i
                                                        class="ri-eye-fill align-middle"
                                                        id="icon-button"
                                                    ></i>
                                                </b-button>
                                            </div>
                                        </div>

                                        <div class="mb-3 d-flex justify-content-between">
                                            <router-link to="/esqueceu-senha">
                                                Esqueceu a senha?
                                            </router-link>
                                            <router-link to="/registrar">
                                                Realizar Cadastro
                                            </router-link>
                                        </div>

                                        <div class="mt-4">
                                            <b-button
                                                variant="soft-primary"
                                                class="w-100 btn-load"
                                                type="submit"
                                            >
                                                <span class="d-flex align-items-center margin-load">
                                                    <span class="flex-grow-1 m-r-10">
                                                        Login
                                                    </span>
                                                    <span
                                                        :class="{ invisible: !load }"
                                                        class="spinner-border flex-shrink-0"
                                                        role="status"
                                                    >
                                                        <span class="visually-hidden"></span>
                                                    </span>
                                                </span>
                                            </b-button>
                                        </div>
                                    </form>
                                </div>

                                <div class="mt-4 text-center">
                                    <div class="signin-other-title">
                                        <h5 class="fs-13 mb-2 title">Entrar com</h5>
                                    </div>
                                    <div>
                                        <a
                                            :href="`${env.url}login/google`"
                                            class="btn btn-danger btn-icon ms-1"
                                        >
                                            <i class="ri-google-fill fs-16"></i>
                                        </a>
                                    </div>
                                </div>

                            </b-card-body>

                            <BCardFooter v-if="env.template_type === 'citidash'">
                                <BRow>
                                    <BCol
                                        xxl="12"
                                        class="text-center"
                                    >
                                        <img
                                            src="@/assets/logos/logo-grande.png"
                                            alt="logo_bauminas"
                                            height="80"
                                        >
                                    </BCol>
                                </BRow>
                            </BCardFooter>

                        </b-card>

                    </b-col>
                </b-row>
            </b-container>
        </div>

        <footer class="footer">
            <b-container>
                <b-row>
                    <b-col lg="12">
                        <div class="text-center">
                            <p class="mb-0 text-muted">
                                &copy; {{ new Date().getFullYear() }}
                                <a
                                    target="_blank"
                                    class="text-primary"
                                    href="https://lifecode.dev/"
                                >LifeCode.
                                </a>
                                Feito com o
                                <i class="mdi mdi-heart text-danger"></i>
                            </p>
                        </div>
                    </b-col>
                </b-row>
            </b-container>
        </footer>
    </div>
</template>

<style>

#auth-particles {
    height: 100%;
}


</style>
